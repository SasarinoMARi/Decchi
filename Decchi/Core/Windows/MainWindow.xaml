<MahApps.Metro.Controls:MetroWindow x:Class="Decchi.Core.Windows.MainWindow"
                                    x:Name="ctlWindow"
									xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
									xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
									xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
									xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                    xmlns:tray="http://www.hardcodet.net/taskbar"
									xmlns:MahApps.Metro.Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
									xmlns:MahApps.Metro.Controls.Dialogs="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
									xmlns:Decchi="clr-namespace:Decchi"
									xmlns:Decchi.Core.Windows.Converter="clr-namespace:Decchi.Core.Windows.Converter"
									Icon="/Decchi;component/icon.ico"
									Title="뎃찌"
									Height="500"
									Width="310"
									ResizeMode="CanMinimize"
									BorderBrush="{DynamicResource AccentColorBrush}"
									BorderThickness="1"
									WindowStartupLocation="CenterScreen"
                                    ShowIconOnTitleBar="False"
                                    LeftWindowCommandsOverlayBehavior="HiddenTitleBar"
									Activated="Window_Activated"
                                    StateChanged="MetroWindow_StateChanged">
	<MahApps.Metro.Controls:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Decchi;component/Core/Windows/Icons/SettingIcon.xaml" />
                <ResourceDictionary Source="/Decchi;component/Core/Windows/Icons/HomeIcon.xaml" />
                <ResourceDictionary Source="/Decchi;component/Core/Windows/Icons/UpdateIcon.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Decchi.Core.Windows.Converter:Visibility2Boolean x:Key="ProfileLoading" WhenTrue="Hidden" WhenFalse="Visible" />
            <Decchi.Core.Windows.Converter:Boolean2Visibility x:Key="Bool2Visible" TrueVisibility="Visible" FalseVisibility="Hidden" />
            <Decchi.Core.Windows.Converter:InvertBoolean x:Key="InvertBoolean"/>
            <Decchi.Core.Windows.Converter:InvertVisibility x:Key="InvertVisibility"/>
        </ResourceDictionary>
    </MahApps.Metro.Controls:MetroWindow.Resources>


    <MahApps.Metro.Controls:MetroWindow.RightWindowCommands>
        <MahApps.Metro.Controls:WindowCommands>
            <Button x:Name="ctlUpdate"
                    Click="ctlUpdate_Click"
                    ToolTip="뎃찌가 업데이트 되었어요!"
                    Visibility="Collapsed">
                <Image Width="16"
                       Height="16"
                       Source="{StaticResource UpdateIcon}" />
            </Button>
            <Button Click="ctlHomepage_Click"
                    ToolTip="뎃찌의 홈페이지를 열어요">
                <Image Width="16"
                       Height="16"
                       Source="{StaticResource HomeIcon}" />
            </Button>
            <Button Click="ctlShowSetting_Click"
                    ToolTip="설정 창을 열어요">
                <Image Width="16"
                       Height="16"
                       Source="{StaticResource SettingIcon}" />
            </Button>
        </MahApps.Metro.Controls:WindowCommands>
    </MahApps.Metro.Controls:MetroWindow.RightWindowCommands>

    <MahApps.Metro.Controls:MetroWindow.Flyouts>
        <MahApps.Metro.Controls:FlyoutsControl>
            <MahApps.Metro.Controls:Flyout x:Name="ctlSetting"
                                           Header="설정"
                                           Position="Right"
                                           Width="150"
                                           Theme="Inverse"
                                           AnimateOpacity="True">
                <ScrollViewer Margin="0 0 0 5">
                    <StackPanel>
                        <GroupBox Header="부팅시 뎃찌 실행"
                                  ToolTip="켬퓨터를 키자마자 뎃찌를 실행해요!">
                            <MahApps.Metro.Controls:ToggleSwitch IsChecked="{Binding Source={x:Static Decchi:Globals.Instance}, Path=WinStartup, Mode=TwoWay}"/>
                        </GroupBox>
                        <GroupBox Header="최소화로 시작"
                                  ToolTip="뎃찌를 키면 바로 최소화해요!">
                            <MahApps.Metro.Controls:ToggleSwitch IsChecked="{Binding Source={x:Static Decchi:Globals.Instance}, Path=TrayStart, Mode=TwoWay}"/>
                        </GroupBox>
                        <GroupBox Header="단축키 사용"
                                  ToolTip="어디서든 키보드 입력 한번으로 뎃찌!! 할 수 있어요!">
                            <StackPanel>
                                <MahApps.Metro.Controls:ToggleSwitch x:Name="ctlUseShortcut"
                                                                     IsChecked="{Binding Source={x:Static Decchi:Globals.Instance}, Path=UseShortcut, Mode=TwoWay}"/>
                                <TextBox x:Name="ctlShortcut"
                                         Grid.Row="1"
                                         Text="{Binding Source={x:Static Decchi:Globals.Instance}, Path=Shortcut, Mode=OneWay}"
                                         IsEnabled="{Binding ElementName=ctlUseShortcut, Path=IsChecked}"
                                         IsReadOnly="True"
                                         TextAlignment="Center"
                                         UndoLimit="0"
                                         PreviewKeyUp="ctlShortcut_PreviewKeyUp"
                                         GotFocus="ctlShortcut_GotFocus"
                                         LostFocus="ctlShortcut_LostFocus"/>
                            </StackPanel>
                        </GroupBox>
                        <GroupBox Header="전체화면에서 사용안함"
                                  ToolTip="전체화면일때 뎃찌!! 하지 않아요"
                                  IsEnabled="{Binding ElementName=ctlUseShortcut, Path=IsChecked}">
                            <MahApps.Metro.Controls:ToggleSwitch IsChecked="{Binding Source={x:Static Decchi:Globals.Instance}, Path=SkipFullscreen, Mode=TwoWay}"/>
                        </GroupBox>
                        <GroupBox Header="로컬 파일 인식"
                                  ToolTip="로컬 파일을 인식해서 트윗해요! 아직 조금 불안정해요!">
                            <MahApps.Metro.Controls:ToggleSwitch IsChecked="{Binding Source={x:Static Decchi:Globals.Instance}, Path=DetectLocalFile, Mode=TwoWay}"/>
                        </GroupBox>

                        <TextBlock HorizontalAlignment="Center"
                                   VerticalAlignment="Bottom"
                                   Text="Sasarino MARi"
                                   Margin="0 20 0 0"/>
                    </StackPanel>
                </ScrollViewer>
            </MahApps.Metro.Controls:Flyout>
        </MahApps.Metro.Controls:FlyoutsControl>
    </MahApps.Metro.Controls:MetroWindow.Flyouts>

    <Grid Margin="5">
        <tray:TaskbarIcon x:Name="ctlTray"
                          IconSource="/Decchi;component/icon.ico"
                          TrayLeftMouseUp="ctlTray_TrayLeftMouseUp"/>
        
		<MahApps.Metro.Controls:ProgressRing Width="128"
                                             Height="128"
											 IsActive="{Binding ElementName=ctlElements, Path=Visibility, Converter={StaticResource ProfileLoading}}" />
        
        <TextBlock x:Name="ctlVersion"
                   HorizontalAlignment="Right"
                   Foreground="{DynamicResource GrayBrush5}"/>
		
		<Grid x:Name="ctlElements">
			<Grid.Style>
				<Style TargetType="FrameworkElement">
					<Style.Triggers>
						<Trigger Property="Visibility" Value="Visible">
							<Trigger.EnterActions>
								<BeginStoryboard>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetProperty="Opacity"
														 From="0.0"
														 To="1.0"
														 Duration="0:0:0.5"/>
									</Storyboard>
								</BeginStoryboard>
							</Trigger.EnterActions>
						</Trigger>
					</Style.Triggers>
				</Style>
			</Grid.Style>

			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="1*" />
				<ColumnDefinition Width="4*" />
				<ColumnDefinition Width="1*" />
			</Grid.ColumnDefinitions>

            <StackPanel Grid.Column="1"
						HorizontalAlignment="Stretch"
						VerticalAlignment="Center">
                <Ellipse Height="{Binding RelativeSource={RelativeSource Self}, Path=ActualWidth}">
                    <Ellipse.OpacityMask>
                        <RadialGradientBrush>
                            <GradientStop Offset="0.95" Color="Black"/>
                            <GradientStop Offset="1.00" Color="Transparent"/>
                        </RadialGradientBrush>
                    </Ellipse.OpacityMask>
                    <Ellipse.Fill>
                        <ImageBrush x:Name="ctlProfileImage"
                                    Stretch="UniformToFill" />
                    </Ellipse.Fill>
                </Ellipse>

                <Viewbox Stretch="Uniform"
						 StretchDirection="DownOnly"
						 Height="32">
                    <TextBlock x:Name="ctlName"
							   FontSize="24"
							   Text="NAME"/>
                </Viewbox>

                <TextBlock x:Name="ctlScreenName"
						   FontSize="15"
						   TextAlignment="Center"
                           Text="@SCREENNAME"
						   Foreground="DarkGray" />

                <Button x:Name="ctlTweet"
						HorizontalAlignment="Stretch"
						Height="60"
						Margin="0 20 0 0"
						Click="ctlTweet_Click">
                    <Button.Content>
                        <Grid>
                            <MahApps.Metro.Controls:ProgressRing IsActive="{Binding ElementName=ctlTweet, Path=IsEnabled, Converter={StaticResource InvertBoolean}}"
																 Width="48"
																 Height="48" />
                            <TextBlock x:Name="ctlTweetText"
                                       Text="뎃찌!!"
                                       ToolTip="이 놀라운 기능을 뎃찌!! 라고 이름붙였답니다"
									   FontSize="30"
									   Visibility="{Binding ElementName=ctlTweet, Path=IsEnabled, Converter={StaticResource Bool2Visible}}"/>
                        </Grid>
                    </Button.Content>
                </Button>
            </StackPanel>

            <StackPanel Grid.ColumnSpan="3"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Bottom">
                <TextBlock Text="{Binding ElementName=ctlShortcut, Path=Text, StringFormat='\{0\} 누르면 어디서든 트윗 가능!'}"
						   Foreground="Red"
						   TextAlignment="Center"
                           Visibility="{Binding ElementName=ctlUseShortcut, Path=IsChecked, Converter={StaticResource Bool2Visible}}"
                           Margin="0 0 0 5"/>

                <TextBox x:Name="ctlFormat"
					     TextWrapping="NoWrap"
					     ScrollViewer.CanContentScroll="True"
                         UndoLimit="10"
					     KeyDown="ctlFormat_KeyDown"
					     LostFocus="ctlFormat_LostFocus"/>
            </StackPanel>
		</Grid>
	</Grid>
</MahApps.Metro.Controls:MetroWindow>
